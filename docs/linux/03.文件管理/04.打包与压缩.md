---
title: 打包与压缩
sidebarPrefix: <i class='iconfont icon-yasuodabao'> </i>
---

在 Linux 系统中，打包和压缩是两个常见的操作，它们通常一起使用，以便于文件的传输、存储和备份。

## 打包

在 Linux 系统中，打包也被称作「归档」（Archiving）。归档是将多个文件和目录整合成一个单一的归档文件的过程，这极大地方便了数据的组织和存储。

归档文件的一个显著优势在于，它们能够保留原始的目录结构和文件属性，确保在解压时能够精确地恢复文件的原始布局。例如，在进行数据备份时，归档可以将相关文件和目录紧凑地封装在一起，便于存储和管理。由于目录结构和文件属性得以保留，在需要恢复数据时，可以更准确地还原到其原始状态。

归档文件的这种形式不仅提高了数据管理的效率，也使得无论是本地存储还是数据传输都变得更加有序和高效。

## 压缩

归档文件和压缩文件都允许将多个文件和目录集合成一个单一的文件，但它们的处理方式有所不同：

- 归档文件保持了文件的原始大小，而压缩文件则通过特殊的存储技术减小了文件所占用的磁盘空间
- 压缩技术的核心在于利用算法减少文件体积，同时保留尽可能多的原始信息。这个过程通常涉及到识别文件中的重复数据，并用一个简短的代码来代替这些重复的数据，从而实现文件体积的缩减

压缩是利用特定算法对文件进行处理，目的是在保留尽可能多的文件信息的同时，让文件的体积变小。其基本原理是查找文件内的重复字节，然后建立一个相同字节的词典文件，并用一个特定的代码来表示这些重复的内容。例如，在一个待压缩的文件中，如果有多处出现「Linux」这样的字符串，在压缩过程中，这个词就会用一个代码表示并写入词典文件，从而实现缩小文件体积的效果。

由于计算机处理的信息是以二进制形式呈现的，所以压缩软件会把二进制信息中相同的字符串用特殊字符标记，通过合理的数学计算，能够极大地压缩文件的体积。将一个或者多个文件用压缩软件进行压缩后，就会形成一个文件压缩包，这样既可以节省存储空间，又方便在网络上进行传送。

如果理解了文件压缩的基本原理，就很容易想到，对文件进行压缩有可能会损坏文件中的内容。因此，压缩可以分为有损压缩和无损压缩。无损压缩比较容易理解，即压缩后的数据必须准确无误，在解压缩后能够完全还原到原始状态。有损压缩则是指即使丢失个别的数据，对文件也不会造成太大的影响。有损压缩广泛应用于动画、声音和图像文件中，比如影碟文件格式 `.mpeg`、音乐文件格式 `.mp3` 以及图像文件格式 `.jpg` 等都是典型代表。

使用压缩工具对文件进行压缩后生成的文件被称为压缩包，通常情况下，压缩包的体积只有原文件的一半甚至更小。需要注意的是，压缩包中的数据无法直接使用，在使用之前需要利用压缩工具将文件数据还原，这个过程又称为解压缩。

## gzip 命令

gzip 是一个在 Unix 和类 Unix 系统（包括 Linux）中广泛使用的文件压缩程序，它属于 GNU 项目的一部分。gzip 代表 GNU zip，它使用 DEFLATE 压缩算法来压缩文件数据，这是一种 Lempel-Ziv 编码（LZ77）的变种，特别适用于压缩文本文件。

```shell
gzip [OPTION]… [FILE]…
```

:::: field-group
::: field name="OPTION" type="常用选项" optional

- `k`：保留原始明文文件。`gzip` 默认压缩后会删除原始明文文件，仅保留 `.gz` 压缩文件；使用该选项后，原始明文文件和压缩文件将同时保留
- `-c`：将压缩结果输出到标准输出，同时保留原始明文文件。不生成磁盘压缩文件，可配合重定向 `>` 保存压缩数据或通过管道 `|` 传递给其他命令
- `-d`：强制开启解压缩模式，功能等同于直接使用 `gunzip` 命令，用于解压 `.gz` 格式压缩文件
- `-r`：递归处理目录。会遍历指定目录下的所有子目录和明文文件，逐一进行压缩操作
- `-l`：列出 `.gz` 压缩文件的详细信息，包括压缩文件大小、原始文件大小、压缩比、原始文件名等
- `-t`：测试 `.gz` 压缩文件的完整性，检查文件是否损坏、能否正常解压。仅返回校验结果（成功无额外输出，失败提示错误信息），不生成任何明文文件
- `-1 ~ -9`：指定压缩级别（数字 1-9）。`-1` 压缩速度最快、压缩率最低；`-9` 压缩速度最慢、压缩率最高；默认压缩级别为 6
:::

::: field name="FILE" type="文件" optional default="标准输入"
指定要压缩的一个或多个文件名称。可指定单个文件，也可使用通配符批量指定多个文件。若省略该参数，`gzip` 会从标准输入读取数据流进行压缩（需配合管道或重定向使用）。
:::
::::

当使用 `gzip` 命令且不加特殊参数来压缩一个文件时（例如 `gzip file.txt`），`gzip` 会读取 file.txt 的内容，通过压缩算法（如 DEFLATE）进行压缩，然后将原始的 file.txt 文件替换为压缩后的 file.txt.gz 文件。从效果上看，原始文件好像被删除了，但实际上它被新的压缩文件所替代。

这是因为 `gzip` 的设计目的之一是节省磁盘空间，通过这种替换方式可以直接利用原始文件的存储空间来存放压缩后的文件。例如，如果原始文件是一个占用大量磁盘空间的大型文本文件，压缩后生成的 `.gz` 文件体积会显著减小，从而更有效地利用磁盘资源。

> [!WARNING]
> `gzip` 本身并不具备将多个文件组合成一个归档文件的功能。例如，如果有文件 file1.txt、file2.txt 和 file3.txt，`gzip` 不能直接把它们打包成一个归档文件，而像 `tar` 这样的工具才可以实现归档操作。因为 `gzip` 命令本身设计用于压缩单个文件，并不直接支持压缩整个目录。

- 基本压缩

    `gzip` 压缩命令非常简单，甚至不需要指定压缩之后的压缩包名，只需指定源文件名即可：

    ```bash
    echo "hello,gzip" > test.log
    ```

    ```bash
    gzip test.log 
    ```

    需要注意，在使用 `gzip` 命令时，默认情况下，原始文件会被替换，也就是说，压缩后，原始文件 test.log 会被压缩文件 test.log.gz 替换。

    ```bash
    ls
    ```

    ```console
    test.log.gz
    ```

- 保留源文件压缩

    在使用 `gzip` 命令压缩文件时，默认行为是压缩完成后删除原始文件，只留下压缩后的文件。如果想要保留源文件可以使用 `-k` 选项：

    ```bash
    echo "hello,gzip" > test1.log
    gzip -k test1.log
    ```

    ```bash
    ls
    ```

    ```console
    test1.log  test1.log.gz  test.log.gz
    ```

- 指定标准输出

    使用 `-c` 选项，它用于将压缩数据输出到标准输出（stdout），而不是直接写入文件。这允许将压缩结果重定向到文件或管道传输给其他命令：

    ```bash
    gzip -c test1.log > /tmp/test1.log.gz
    ```

    ```bash
    ls /tmp/ | grep "test1"
    ```

    ```console
    test1.log.gz
    ```

    ```bash
    ls
    ```

    ```console
    test1.log  test1.log.gz  test.log.gz
    ```

    这条命令会压缩当前目录下的 test1.log 文件，但不修改原文件，而是将压缩后的数据流重定向到 `/tmp` 目录下的 test1.log.gz 文件中。

    > [!WARNING] 不能直接将重定向输出到文件夹
    > 重定向符号 `>` 的作用是「将命令输出写入具体文件」，而非文件夹；系统无法把压缩后的数据流直接塞进文件夹，必须指定具体的文件名。

- 压缩目录

    `gzip` 命令并不具备直接压缩目录及其子文件的功能。如果尝试对一个目录使用 `gzip` 命令，会收到一个错误消息，因为 `gzip` 只能对单个文件进行操作。

    ```bash
    gzip /tmp
    ```

    ```console
    gzip: /tmp/ is a directory -- ignored
    ```

    如果希望对目录下所有文件（包括子目录中的文件）进行压缩，需要使用 `-r` 选项，这样它就会递归地对目录及其子目录中的所有文件逐个进行压缩。

    首先创建一个目录并放入一些文件：

    ```bash
    mkdir -p /tmp/test_dir/sub_dir
    touch /tmp/test_dir/file1.txt
    touch /tmp/test_dir/file2.log
    touch /tmp/test_dir/sub_dir/file3.conf
    ```

    ```bash
    ls -R /tmp/
    ```

    ```console
    /tmp:
    test1.log.gz  test_dir

    /tmp/test_dir:
    file1.txt  file2.log  sub_dir

    /tmp/test_dir/sub_dir:
    file3.conf
    ```

    ```bash
    gzip -r /tmp/test_dir/
    ```

    ```bash
    ls -R /tmp/test_dir/
    ```

    ```console
    /tmp/test_dir/:
    file1.txt.gz  file2.log.gz  sub_dir

    /tmp/test_dir/sub_dir:
    file3.conf.gz
    ```

    可以看到，所有普通文件（file1.txt、file2.log、file3.conf）都变成了压缩文件，原文件（非压缩版）已经被自动删除。

- 标准输入压缩

    除了直接压缩文件外，`gzip` 还可以从标准输入（stdin）读取数据进行压缩。这在处理管道（pipe）或其他命令的输出时非常有用：

    ```bash
    ls -l | gzip > dir_list.gz
    ```

    输入来源是其他命令（`cat`/`ls` 等）的输出，通过管道传递，属于标准输入。

## gunzip 命令

`gunzip` 是一个用于解压缩文件的命令，主要用于处理由 `gzip` 压缩的文件。在 Linux 和 Unix 系统中，它是一个常用的工具。其功能是将以 `.gz` 为后缀的压缩文件恢复为原始的未压缩文件格式。`gunzip` 和 `gzip` 实际上是一个程序的不同调用方式，`gunzip` 等价于 `gzip -d`。

```shell
gunzip [OPTION]... [FILE]...
```

:::: field-group
::: field name="OPTION" type="常用选项" optional

- `-k`：保留原始 `.gz` 压缩文件。`gunzip` 默认解压后会删除原始压缩文件，仅保留解压后的明文文件；使用该选项后，压缩文件和明文文件将同时保留。
- `c`：将解压结果输出到标准输出，不生成磁盘明文文件。可配合重定向 `>` 保存明文数据或通过管道 `|` 传递给其他命令
- `-l`：列出 `.gz` 压缩文件的详细信息，包括压缩文件大小、原始文件大小、压缩比、原始文件名等，与 `gzip -l` 功能一致
- `-t`：测试压缩文件的完整性，检查文件是否损坏、是否能正常解压。执行后仅返回校验结果（成功无额外输出，失败提示错误信息），不生成任何明文文件
:::

::: field name="FILE" type="文件" optional default="标准输入"
指定要解压的一个或多个 .gz 格式压缩文件名称。可指定单个压缩文件，也可使用通配符批量指定多个压缩文件。若省略该参数，`gunzip` 会从标准输入读取 `.gz` 压缩数据流进行解压（需配合管道或重定向使用）。
:::
::::

- 直接解压缩文件

    ```bash
    gunzip test.log.gz 
    ls
    ```

    ```console
    test1.log  test1.log.gz  test.log
    ```

    还可以使用 `gzip -d` 命令，同样也可以解压文件，如果想保留源文件，可以使用 `-k` 选项：

    ```bash
    gzip -dk test1.log.gz
    ```

    ```console
    gzip: test1.log already exists; do you wish to overwrite (y or n)? y
    ```

    ```bash
    ls
    ```

    ```console
    test1.log  test1.log.gz  test.log
    ```

- 解压缩目录下的内容

    ```bash
    gzip -dkr  /tmp/test_dir/
    ```

    ```bash
    ls -R /tmp/test_dir/
    ```

    ```console
    /tmp/test_dir/:
    file1.txt  file1.txt.gz  file2.log  file2.log.gz  sub_dir

    /tmp/test_dir/sub_dir:
    file3.conf  file3.conf.gz
    ```

    如果压缩的是一个纯文本文件，则可以直接使用 `zcat` 命令在不解压缩的情况下查看这个文本文件中的内容：

    ```bash
    zcat /tmp/test_dir/file2.log.gz 
    ```

    ```console
    hello,gzip
    ```

## bzip2 命令

`bzip2` 是一个用于文件压缩和解压缩的命令行工具。它使用了 Burrows-Wheeler 块排序文本压缩算法和霍夫曼编码，能够有效地减小文件的大小，节省存储空间并方便文件传输。这种压缩算法在处理文本文件和其他一些数据文件时表现出色。

> [!TIP]
> 在 Rocky Linux 最小安装下默认是没有安装 `bzip2` 命令的，可以通过 `dnf` 进行安装：`dnf -y install bzip2`

与 `gzip` 相比，`bzip2` 通常可以提供更高的压缩率，但压缩和解压缩的速度稍慢，尤其适合文本文件和其他可以容忍少量压缩和解压缩时间的数据。

```shell
bzip2 [OPTION]... [FILE]...
```

:::: field-group
::: field name="OPTION" type="常用选项" optional

- `k`：保留原始明文文件。bzip2 默认压缩后会删除原始明文文件，仅保留 `.bz2` 压缩文件；使用该选项后，原始明文文件和压缩文件将同时保留
- `-d`：强制开启解压缩模式，功能等同于直接使用 `bunzip2` 命令，用于解压 `.bz2` 格式压缩文件
- `-z`：强制开启压缩模式，这是 `bzip2` 的默认行为，通常无需显式指定，仅在默认行为被修改时备用
- `-t`：测试 `.bz2` 压缩文件的完整性，检查文件是否损坏、能否正常解压。仅返回校验结果（成功无额外输出，失败提示错误信息），不生成任何明文文件
- `-c`：将压缩结果输出到标准输出，不生成磁盘压缩文件，同时保留原始明文文件。可配合重定向 `>` 保存压缩数据或通过管道 `|` 传递给其他命令
- `-s`：启用低内存模式，限制 `bzip2` 最大内存占用不超过 2500KB，适用于嵌入式系统、老旧服务器等内存紧张的设备
- `-1 ~ -9`：指定压缩块大小（对应 100KB~900KB），间接决定压缩级别。`-1`（别名 `--fast`）压缩速度最快、压缩率最低；`-9`（别名 `--best`）压缩速度最慢、压缩率最高；默认压缩级别为 9
:::

::: field name="FILE" type="文件" optional default="标准输入"
指定要压缩的一个或多个文件名称。可指定单个文件，也可使用通配符批量指定多个文件。若省略该参数，`bzip2` 会从标准输入读取数据流进行压缩（需配合管道或重定向使用）。
:::
::::

- 压缩多个文件并保留原始文件

    ```shell
    bzip2 -k test.log test1.log
    ls
    ```

    ```console
    test1.log  test1.log.bz2  test1.log.gz  test.log  test.log.bz2
    ```

- 测试多个压缩文件的完整性

    ```bash
    bzip2 -tv test.log.bz2 test1.log.bz2 
    ```

    ```console
    test.log.bz2: ok
    test1.log.bz2: ok
    ```

    这里，`-t` 指定要进行模拟解压，不实际生成结果，也就是说类似检查文件，当然就算目录下面有 test.txt 也不会有什么错误输出了，因为它根本不会真的解压文件。为了在屏幕上输出，这里加上 `-v` 选项了。

## bunzip2 命令

`bunzip2` 是一个用于解压缩 `.bz2` 格式文件的命令行工具。它是 `bzip2` 压缩工具的配套程序，主要作用是将通过 `bzip2` 压缩后的文件恢复到原始状态。

```shell
bzip2 [OPTION]... [FILE]...
```

:::: field-group
::: field name="OPTION" type="常用选项" optional

- `-k`：保留原始 `.bz2` 压缩文件。`bunzip2` 默认解压后会删除原始压缩文件，仅保留解压后的明文文件；使用该选项后，压缩文件和明文文件将同时保留
- `-f`：强制覆盖已存在的解压输出文件，跳过默认的覆盖确认提示，提升批量处理效率
- `-d`：强制开启解压模式，这是 bunzip2 的默认行为，通常无需显式指定，仅在默认行为被修改时备用
- `-z`：强制切换为压缩模式，功能等同于直接使用 bzip2 命令，覆盖 bunzip2 的默认解压行为
`-t`：测试 `.bz2` 压缩文件的完整性，检查文件是否损坏、能否正常解压，仅返回校验结果（成功无额外输出，失败提示错误），不生成任何明文文件
- `-c`：将解压结果输出到标准输出，不生成磁盘明文文件。可配合重定向 `>` 保存明文数据或通过管道 `|` 传递给其他命令，功能等同于 `bzcat`
- `-q`：静默模式，抑制非关键性错误信息，仅保留致命错误提示，减少终端冗余输出
- `-v`：详细模式，显示解压的详细进度信息（文件名、解压大小等）；添加 2 次 `-vv` 可输出更详尽的调试级信息
- `-s`：启用低内存模式，限制 `bunzip2` 最大内存占用不超过 2500KB，适合嵌入式系统、老旧服务器等内存紧张的设备
`-1 ~ -9`：仅在配合 `-z` 开启压缩模式时有效，用于指定压缩块大小（100KB~900KB），对 `bunzip2` 的解压操作无实际影响
:::
::: field name="FILE" type="文件" optional default="标准输入"
指定要解压的一个或多个 `.bz2` 格式压缩文件名称。可指定单个压缩文件，也可使用通配符批量指定多个压缩文件。若省略该参数，`bunzip2` 会从标准输入读取 `.bz2` 压缩数据流进行解压（需配合管道或重定向使用）。
:::

- 解压文件

    ```bash
    bunzip2 test.log.bz2
    ```

    这会将 test.log.bz2 解压为 test.log，并且删除原始的 `.bz2` 文件。

- 保留原文件解压文件

    ```bash
    bunzip2 -k test1.log.bz2
    ```

## xz 命令

`xz` 是一款开源的高性能无损数据压缩工具，核心依托 LZMA2 压缩算法构建，是 `gzip`、`bzip2` 的进阶替代方案，在软件源码打包、系统镜像备份、大型文件归档等场景中广泛应用。

- **压缩性能突出**：压缩率显著高于 `gzip`（DEFLATE 算法）和 `bzip2`（块排序算法），能将文件压缩到更小体积，尤其对大文件（如 GB 级日志、镜像）的压缩优化更为明显。
- **速度与内存权衡**：压缩 / 解压速度相对 `gzip` 更慢，占用内存略高（因需更复杂的数据分析和编码），适合对存储体积要求优先、对处理速度要求不苛刻的场景。

```shell
xz [OPTION]... [FILE]...
```

:::: field-group
::: field name="OPTION" type="常用选项" optional

- `-z`：强制开启压缩模式。这是 `xz` 的默认行为，通常无需显式指定，仅在需要覆盖其他默认行为（如误设解压参数）时使用
- `-d`：强制开启解压模式，功能等同于专用解压工具 `unxz`，用于解压 `.xz` 格式压缩文件
- `-t`：测试 `.xz` 压缩文件的完整性，检查文件是否损坏、能否正常解压。仅返回校验结果（成功无额外输出，失败提示错误信息），不生成任何明文文件
- `-l`：列出 `.xz` 压缩文件的详细信息，包括压缩文件大小、原始文件大小、压缩率、压缩级别、使用的算法等核心信息
- `-k`：保留原始输入文件（不删除原文件）。`xz` 默认压缩后删除原始明文文件、解压后删除原始 `.xz` 压缩文件，该选项可保留原始文件，仅生成目标文件（压缩文件 / 明文文件）
- `-f`：强制覆盖已存在的输出文件；同时支持对符号链接文件进行压缩 / 解压操作，跳过默认的符号链接校验限制
- `-c`：将压缩 / 解压结果输出到标准输出，且不删除原始输入文件。不生成磁盘文件，可配合重定向 `>` 保存数据或管道 `|` 传递给其他命令
- `-0 ~ -9`：指定压缩预设级别（默认级别为 6）。级别越高压缩率越高，但压缩速度越慢、占用内存越多；使用 7-9 级别前需确认系统内存充足，避免内存不足导致操作失败。
- `-e`：极致压缩模式。通过消耗更多 CPU 时间来进一步提升压缩比，不影响解压时的内存占用和解压速度，需配合 `-0 ~ -9` 级别使用（通常搭配 `-9` 达到最优压缩效果）
- `-T`：指定压缩 / 解压使用的最大线程数。默认值为 0（自动使用与 CPU 核心数一致的线程数），可手动指定具体数值（如 `-T 4` 表示使用 4 个线程），提升多核心设备的处理速度
- `-q`：静默模式。首次指定抑制警告信息，第二次指定（`-qq`）可同时抑制错误信息，仅保留致命错误提示
- `-v`：详细模式。首次指定显示基础处理信息（文件名、压缩率 / 解压进度等），第二次指定（`-vv`）显示更详尽的调试级信息
:::
::: field name="FILE" type="文件" optional default="标准输入"
指定要压缩的一个或多个文件名称。可指定单个文件，也可使用通配符批量指定多个文件。若省略该参数，`xz` 会从标准输入读取数据流进行压缩（需配合管道或重定向使用）。
:::
::::

- 压缩并保留原文件

    ```bash
    echo "hello,xz" > xz.log
    ```

    ```bash
    xz -k test.log
    ls
    ```

    ```console
    xz.log  xz.log.xz
    ```

- 压缩后输出到标准输出，重定向保存

    ```bash
    xz -c xz.log > /tmp/xz.log.xz
    ls /tmp/ | grep xz.log.xz
    ```

    ```console
    xz.log.xz
    ```

- 流式压缩，配合管道传递数据

    ```bash
    cat /etc/passwd | xz  > ~/passwd.xz
    ls
    ```

    ```console
    passwd.xz  xz.log  xz.log.xz
    ```

    使用管道方式时候，不用担心源文件被删除，因为 `xz` 只删除「直接指定为 FILE 参数的文件」，而命令中 `xz` 根本没碰 `/etc/passwd`。`cat /etc/passwd`：仅读取 `/etc/passwd` 的内容把内容输出到管道（相当于复制一份内容数据流），不对源文件做任何修改 / 删除操作。

## unxz 命令

`unxz` 是 `xz` 工具的专用解压命令，本质是 `xz -d` 的软链接，功能与 `xz -d` 完全一致，专门用于解压 `.xz` 格式压缩文件，用法简洁且聚焦解压场景。

```shell
unxz [OPTION]... [FILE]...
```

:::: field-group
::: field name="OPTION" type="常用选项" optional

- `-k`：保留原始 `.xz` 压缩文件。unxz 默认解压后删除 `.xz` 文件，加此选项可同时保留压缩文件和解压后的明文文件
- `-f`：强制覆盖已存在的明文输出文件，跳过覆盖确认提示，适合批量解压场景
- `-c`：将解压后的明文内容输出到标准输出（终端 / 管道），不生成磁盘明文文件，也不删除原始 `.xz` 文件
- `-t`：测试 `.xz` 压缩文件完整性，仅检查是否损坏，不执行实际解压操作
- `-q`：静默模式，抑制非致命警告 / 错误信息，减少终端输出
- `-v`：详细模式，显示解压进度（如文件名、处理大小）
- `-d`：强制开启解压模式（`unxz` 默认行为，无需显式指定）
:::
::: field name="FILE" type="文件" optional default="标准输入"
指定要解压的一个或多个 `.xz` 压缩文件名称。可指定单个文件，也可使用通配符批量指定多个文件。若省略该参数，`unxz` 会从标准输入读取 `.xz` 压缩数据流进行解压（需配合管道或重定向使用）。
:::
::::

- 解压并保留原文件

    ```bash
    unxz -k passwd.xz
    ls
    ```

    ```console
    passwd  passwd.xz  xz.log  xz.log.xz
    ```

## tar 命令

`tar` 是 Linux/Unix 系统中最常用的归档工具，核心功能是将多个文件 / 目录打包成一个单独的归档文件（通常称为 `tar` 包），方便传输、备份或存储。它本身不负责压缩，但可以配合 `gzip`、`bzip2` 等压缩工具实打包 + 压缩一体化操作。

> [!TIP]
> 在 Rocky Linux 最小安装下默认是没有安装 `tar` 命令的，可以通过 `dnf` 进行安装：`dnf -y install tar`

```shell
tar [OPTION...] [FILE]...
```

:::: field-group
::: field name="OPTION" type="常用选项" optional
核心操作模式：

- `-c`：创建新的归档文件。用于将指定文件 / 目录打包成 `.tar` 归档文件，可搭配压缩选项生成压缩归档（如 `.tar.gz`、`.tar.bz2`）
- `-x`：从归档文件中提取（解压）文件 / 目录。可提取归档中全部内容，也可指定单个文件进行精准提取
- `-t`：列出归档文件中的内容清单。仅查看归档内包含的文件名、大小等信息，不执行解压操作
- `-r`：向已存在的归档文件末尾追加文件 / 目录。仅支持未压缩的 `.tar` 归档，不支持压缩格式归档（如 `.tar.gz`、`.tar.bz2`）

核心修饰符：

- `-f`：指定归档文件的名称。必须紧跟归档文件名，是使用 `tar` 的必备选项（无此选项则无法指定归档文件）
- `-v`：详细输出模式。显示归档 / 解压 / 列清单的详细过程（如处理的文件名、大小等），便于跟踪操作进度
- `-k`：保留原有文件。解压时不覆盖系统中已存在的同名文件，避免误删现有数据
- `-C`：切换到指定目录进行操作。归档时：先切换到目标目录再打包文件；解压时：将文件解压到指定目录
- `-p`：保留文件的原始权限和属性。解压时还原文件的所有者、所属组、读写权限等信息，适用于备份 / 还原系统文件

压缩相关选项：

- `-z`：使用 `gzip` 压缩 / 解压。归档时生成 `.tar.gz` 格式（体积更小），解压时识别 `.tar.gz` 格式归档，等同于搭配 `gzip` 工具
- `-j`：使用 `bzip2` 压缩 / 解压。归档时生成 `.tar.bz2` 格式，解压时识别 `.tar.bz2` 格式归档，等同于搭配 `bzip2` 工具
- `-J`：使用 `xz` 压缩 / 解压。归档时生成 `.tar.xz` 格式（压缩率更高），解压时识别 `.tar.xz` 格式归档，等同于搭配 `xz` 工具
- `-a`：自动根据归档文件后缀选择对应压缩程序。无需手动指定 `-z`/`-j`/`-J`，`tar` 会自动识别并调用对应工具

常用辅助选项：

- `-N`：仅归档比指定日期 / 文件更新的文件。用于增量备份，只打包新增或修改过的文件
- `--strip-components`：解压时剥离文件名前的指定目录层级。如 `--strip-components=1` 表示解压时去掉归档中最外层目录，避免多余目录嵌套
- `-O`：将解压后的文件内容输出到标准输出。不生成磁盘文件，可配合管道传递给其他命令处理
:::
::: field name="FILE" type="文件 / 归档文件" optional default="标准输入 / 标准输出"
当使用 `-c`（创建归档）时：指定要归档的一个或多个文件 / 目录名称，可使用通配符批量指定。

当使用 `-x`（解压归档）/ `-t`（列出归档）时：指定要操作的归档文件名称，可指定单个归档文件，也可批量指定多个归档文件。

若省略该参数，`tar` 会采用流式处理：从标准输入读取数据（解压 / 列出）或向标准输出写入数据（归档），需配合管道 `|` 或重定向 `<`/`>` 使用。
:::
::::

示例：

- 将多个文件打包成 `.tar` 文件（不压缩）

    ```bash
    tar -cvf archive.tar /etc/passwd /etc/shadow
    ```

    ```console
    tar: Removing leading `/' from member names
    /etc/passwd
    tar: Removing leading `/' from hard link targets
    /etc/shadow
    ```

    `tar: Removing leading '/' from member names`：这条信息表明 `tar` 在打包过程中自动移除了文件路径中的前导斜杠 `/`。这是 `tar` 的标准行为，目的是为了在解压缩时提供更大的灵活性。如果不移除这些斜杠，那么归档中的文件路径将会是绝对路径，这可能会导致在不同系统或目录下解压缩时出现问题。

    `tar: Removing leading '/' from hard link targets`：这条信息表明 `tar` 在处理硬链接时也移除了前导斜杠 `/`。硬链接是文件系统中的链接，指向相同的文件内容。当一个文件被硬链接到另一个位置时，它们共享相同的数据块，因此任何对文件内容的修改都会反映在所有硬链接上。在 `tar` 打包过程中，如果 `/etc/shadow` 文件被硬链接到其他位置，`tar` 会记录这些硬链接的目标文件路径。由于 `tar` 默认移除前导斜杠 `/`，所以硬链接的目标路径也会被相应地调整。

    ```bash
    ll archive.tar
    ```

    ```console
    -rw-r--r--. 1 root root 10240 Nov 22 11:38 archive.tar
    ```

- 查看和提取归档文件中的内容

    ```bash
    tar -tvf archive.tar 
    ```

    ```console
    -rw-r--r-- root/root       892 2024-11-18 08:51 etc/passwd
    ---------- root/root       579 2024-11-18 08:53 etc/shadow
    ```

    这个文件 archive.tar 是一个由 `tar` 命令创建的归档文件，但没有经过压缩。可以通过 `x` 选项提取这个归档文件的内容到当前目录：

    ```bash
    tar -xvf archive.tar
    ```

    ```console
    etc/passwd
    etc/shadow
    ```

    ```bash
    ll etc/
    ```

    ```console
    total 8
    -rw-r--r--. 1 root root 892 Nov 18 08:51 passwd
    ----------. 1 root root 579 Nov 18 08:53 shadow
    ```

    如果想要将归档文件中的内容提取到一个指定的目录，可以使用 `-C` 选项来指定目标目录：

    ```bash
    tar -xvf archive.tar -C /opt/
    ```

    ```console
    etc/passwd
    etc/shadow
    ```

    ```bash
    ll /opt/etc/
    ```

    ```console
    total 8
    -rw-r--r--. 1 root root 892 Nov 18 08:51 passwd
    ----------. 1 root root 579 Nov 18 08:53 shadow
    ```

- 使用 gzip 压缩的归档文件

    ```bash
    tar -czvf etc.tar.gz /etc/
    ```

    执行这个命令后，`/etc/` 目录下的所有文件和子目录将被打包并压缩到名为 etc.tar.gz 的归档文件中。没有指定路径，归档文件将位于执行命令的当前目录。

- 使用 bzip2 压缩的归档文件

    ```bash
    tar -cjvf var.tar.bz2 /var/
    ```

    要解压这个使用 bzip2 压缩的归档文件 var.tar.bz2，可以使用以下命令：

    ```bash
    tar -xjvf var.tar.bz2
    ```

    执行这个命令后，var.tar.bz2 中的内容将被解压并提取到执行命令的当前目录中。如果归档文件中包含目录结构，这些目录和文件将按照它们在归档中的结构被重建。

- 更新与删除归档文件

    更新归档文件意味着想要将新文件添加到现有的归档中，或者更新归档中已经存在的文件。`tar` 命令使用 `-u` 选项来更新归档文件：

    ```bash
    tar -uvf archive.tar test.txt
    ```

    ```console
    test.txt
    ```

    执行上述命令后，test.txt 文件将被添加到 archive.tar 归档中：

    ```bash
    tar -tvf archive.tar
    ```

    ```console
    -rw-r--r-- root/root       892 2024-11-18 08:51 etc/passwd
    ---------- root/root       579 2024-11-18 08:53 etc/shadow
    -rw-r--r-- root/root        10 2024-11-29 09:54 test.txt
    ```

    要从 `tar` 归档文件中删除文件，可以使用 `--delete` 选项。这个选项允许指定一个或多个文件，这些文件将从归档中删除。请注意，这个操作会直接修改归档文件：

    ```bash
    tar -vf archive.tar --delete test.txt 
    ```

    ```bash
    tar -tvf archive.tar
    ```

    ```console
    -rw-r--r-- root/root       892 2024-11-18 08:51 etc/passwd
    ---------- root/root       579 2024-11-18 08:53 etc/shadow
    ```

    > [!WARNING]
    > 对于使用 `tar` 创建的压缩包（如 `.tar.gz` 或 `.tar.bz2`），`tar` 命令本身不支持直接进行更新和删除操作。这是因为压缩归档文件是一个整体，`tar` 命令没有提供直接修改压缩归档内容的功能。
